# Проект: Прогнозирование снижения покупательской активности клиентов интернет-магазина

## **План работы**

- Загрузка данных : Загрузка и проверка исходных данных из предоставленных таблиц.
- Предобработка данных : Обработка пропусков, дубликатов, типов данных и других аномалий.
- Исследовательский анализ данных : Анализ распределений, взаимосвязей и отбор клиентов с активностью не менее трёх месяцев.
- Объединение таблиц : Создание единой таблицы для моделирования путём объединения данных из всех файлов.
- Корреляционный анализ : Исследование мультиколлинеарности и подготовка данных для моделирования.
- Использование пайплайнов : Разработка пайплайнов для обработки данных и поиска лучшей модели.
- Анализ важности признаков : Оценка значимости признаков с использованием метода SHAP.
- Сегментация покупателей : Выделение сегментов на основе результатов моделирования и данных о прибыльности.
- Общий вывод : Подведение итогов, описание выбранной модели и предложений для бизнеса.

## **Описание задачи**
Цель проекта — построить модель, которая предскажет вероятность снижения покупательской активности клиентов в следующие три месяца. Это позволит бизнесу своевременно принимать меры для удержания ценных клиентов и минимизации потерь дохода.

Для решения задачи использовались данные о поведении покупателей на сайте, их прибыльности, маркетинговых коммуникациях и других факторах. На основе анализа данных были выделены ключевые сегменты клиентов, требующие особого внимания.

---

## **Исходные данные и предобработка**

### **Исходные данные:**
- Четыре таблицы:
  1. `market_file.csv` — данные о поведении покупателей (например, тип сервиса, маркетинговая активность, популярная категория товаров).
  2. `market_money.csv` — данные о выручке, которую получает магазин от каждого клиента.
  3. `market_time.csv` — данные о времени, проведённом клиентами на сайте.
  4. `money.csv` — данные о среднемесячной прибыли продавца за последние 3 месяца.

### **Предобработка данных:**
1. Объединение таблиц через уникальный идентификатор клиента (`id`).
2. Преобразование количественных и категориальных признаков с использованием `ColumnTransformer`:
   - Количественные признаки масштабировались с помощью `StandardScaler` и `MinMaxScaler`.
   - Категориальные признаки кодировались с помощью `OneHotEncoder` и `OrdinalEncoder`.
3. Удаление пропущенных значений и преобразование типов данных.
4. Разбиение данных на обучающую и тестовую выборки (80% / 20%).

---

## **Поиск лучшей модели**

Для поиска лучшей модели были выполнены следующие шаги:

1. **Обучение четырёх моделей**:
   - KNeighborsClassifier
   - DecisionTreeClassifier
   - LogisticRegression
   - SVC

2. **Подбор гиперпараметров**:
   - Для каждой модели был выполнен подбор гиперпараметров с помощью `GridSearchCV` или `RandomizedSearchCV`.
   - В качестве метрики использовался F1-score, так как он учитывает баланс между точностью (precision) и полнотой (recall), что важно для задачи с несбалансированными классами.

3. **Оценка моделей**:
   - Модели сравнивались по метрикам F1-score, ROC-AUC, precision, recall и accuracy.

**Результаты:**
- Лучшая модель: **SVC**. 
- Лучшие параметры для модели: `{'classifier__C': 0.8751328233611145, 'classifier__degree': 3, 'classifier__gamma': 'auto', 'classifier__kernel': 'rbf'}`
- F1-score: **0.8398**, Recall для класса 1 (снижение активности): **0.76**, Precision для класса 1: **0.92**.

---

## **Анализ важности признаков**

Для лучшей модели (`SVC`) был выполнен анализ важности признаков с использованием SHAP:
- Наиболее значимые признаки:
  - "Выручка текущего месяца" (`выручка_текущий_месяц`)
  - "Маркетинговая активность в текущем месяце" (`маркет_актив_тек_мес`)
  - "Время на сайте в текущем месяце" (`время_минут_текущий_месяц`)
- Малозначимые признаки:
  - "Ошибки сервиса" (`ошибка_сервиса`)
  - "Неоплаченные продукты" (`неоплаченные_продукты_штук_квартал`)
  - "Разрешение на сообщения" (`разрешить_сообщать`)

Эти результаты помогли лучше понять факторы, влияющие на снижение покупательской активности.

---

## **Сегментация покупателей**

На основе предсказаний модели и данных о прибыльности клиентов были выделены четыре сегмента:
1. Высокая_прибыль_прежний_уровень
2. Низкая_прибыль_прежний_уровень
3. Высокая_прибыль_снижение_активности
4. Низкая_прибыль_снижение_активности

Для дальнейшего анализа был выбран сегмент **"Высокая_прибыль_снижение_активности"**, так как это ценные клиенты, которые могут быть потеряны.

**Характеристика сегмента:**
- Клиенты остаются высоко прибыльными (средняя прибыльность: **4.76 единиц**).
- Активность снижается, что делает их уязвимыми для потери.

---

## **Предложения для выбранного сегмента**

Для удержания клиентов из сегмента **"Высокая_прибыль_снижение_активности"** были предложены следующие меры:

1. **Персонализированные акции**:
   - Разработать индивидуальные предложения на основе популярных категорий товаров.

2. **Программа лояльности**:
   - Ввести дополнительные баллы или бонусы за каждую покупку.

3. **Улучшение сервиса**:
   - Устранить ошибки сервиса и повысить качество обслуживания.

4. **Снижение маркетинговой активности**:
   - Уменьшить частоту рассылок и звонков, чтобы снизить вероятность усталости.

5. **Опрос клиентов**:
   - Провести опрос среди клиентов этого сегмента, чтобы выяснить причины снижения активности.

---

## **Заключение**

В ходе работы была решена задача прогнозирования снижения покупательской активности клиентов. Была построена модель `SVC`, которая показала высокое качество предсказаний (F1-score = **0.8398**). Анализ важности признаков выявил ключевые факторы, влияющие на снижение активности, такие как выручка, маркетинговая активность и время на сайте.

На основе предсказаний модели был выделен сегмент **"Высокая_прибыль_снижение_активности"**, который требует особого внимания. Для удержания этих клиентов были предложены персонализированные акции, программы лояльности и улучшение качества сервиса.

Результаты исследования могут быть использованы для разработки стратегий удержания клиентов и увеличения доходов компании.
